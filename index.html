<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#0f6b4f">
  <title>Iqlim o'zgarishi bo'yicha Milliy markaz</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;600;700&family=Sora:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#edf7f1;--c:#123627;--m:#4f6f63;--b:#c5ddd2;--w:#fff;--a:#0f6b4f;--a2:#0f618f}
    *{box-sizing:border-box} body{margin:0;font-family:"Public Sans",sans-serif;color:var(--c);background:linear-gradient(180deg,#edf7f1,#dceee4)}
    h1,h2,h3{font-family:"Sora",sans-serif;margin:0} p{margin:0;line-height:1.6} a{color:var(--a2);text-decoration:none} a:hover{text-decoration:underline}
    .wrap{width:min(1080px,100% - 2rem);margin-inline:auto}
    .top{position:sticky;top:0;background:#edf7f1e8;backdrop-filter:blur(8px);border-bottom:1px solid var(--b);z-index:20}
    .top .wrap{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:.7rem 0}
    .logo{display:flex;gap:.6rem;align-items:center}.mark{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#31a776,#0f618f);display:grid;place-items:center;color:#fff;font-weight:700}
    .logo small{display:block;color:var(--m)} nav{display:flex;gap:.45rem;flex-wrap:wrap} nav a{padding:.35rem .55rem;border-radius:.5rem;font-size:.88rem;color:var(--c);font-weight:600}
    nav a:hover{text-decoration:none;background:#d9ece2}
    .hero{padding:2rem 0 1rem;display:grid;grid-template-columns:1.25fr .95fr;gap:.8rem}
    .card{background:var(--w);border:1px solid var(--b);border-radius:14px;padding:1rem}
    .pill{font-size:.74rem;background:#ddf4e9;border:1px solid #bde0cd;border-radius:999px;padding:.24rem .6rem;display:inline-block;font-weight:700;margin-bottom:.6rem}
    .muted{color:var(--m);font-size:.9rem}
    .meta{display:grid;gap:.45rem}.meta div{display:flex;justify-content:space-between;gap:.5rem;border:1px solid var(--b);border-radius:10px;padding:.5rem .6rem;background:#f8fdfb;font-size:.86rem}
    section{margin-top:.8rem}
    .head{display:flex;justify-content:space-between;align-items:end;gap:.6rem;margin-bottom:.7rem}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem}
    .tile{border:1px solid var(--b);background:#f8fdfb;border-radius:12px;padding:.8rem}
    .tile h3{font-size:.95rem;margin-bottom:.35rem}.tile p{font-size:.88rem;color:var(--m);margin-bottom:.4rem}
    .timeline,.pubs{display:grid;gap:.55rem}
    .item{border:1px solid var(--b);border-radius:12px;background:#fff;padding:.8rem}
    .item-top{display:flex;justify-content:space-between;gap:.6rem;align-items:center;flex-wrap:wrap;margin-bottom:.35rem}
    .badge{font-size:.72rem;padding:.18rem .5rem;border-radius:999px;border:1px solid #b9dced;background:#e9f5fb;color:#115b7e;font-weight:700}
    .item p{font-size:.9rem;color:var(--m);margin:.35rem 0}
    .tools{display:flex;gap:.5rem;flex-wrap:wrap}
    input,select,textarea,button{font:inherit;border:1px solid #b9d6c8;border-radius:10px;background:#fff;color:var(--c);padding:.52rem .62rem}
    input,select{min-height:2.25rem} textarea{min-height:92px;resize:vertical}
    button{cursor:pointer;font-weight:600}
    .pri{background:linear-gradient(135deg,var(--a),var(--a2));color:#fff;border-color:var(--a)}
    .admin{display:grid;grid-template-columns:.95fr 1.05fr;gap:.65rem}
    .field{display:grid;gap:.25rem;margin-bottom:.45rem}.field label{font-size:.8rem;color:var(--m);font-weight:600}
    .status{font-size:.8rem;border:1px solid;border-radius:9px;padding:.45rem .55rem;margin-top:.5rem}
    .ok{color:#1c7b47;background:#f3fbf6;border-color:#bde2cb}.warn{color:#9d5814;background:#fff8ef;border-color:#f0d3b4}.err{color:#a62a2a;background:#fff5f5;border-color:#f0c6c6}
    .hidden{display:none!important}
    .preview p{margin-bottom:.45rem;color:#2b4b3f}
    .imgs{display:grid;grid-template-columns:repeat(3,1fr);gap:.35rem;margin-top:.45rem}
    .imgs img{width:100%;max-height:130px;object-fit:cover;border:1px solid #bcd8ca;border-radius:8px}
    ul.src{list-style:none;padding:0;margin:0;display:grid;gap:.45rem}
    ul.src li{border:1px solid var(--b);border-radius:10px;padding:.55rem .65rem;background:#f8fdfb;font-size:.88rem}
    footer{border-top:1px solid var(--b);margin-top:1rem;padding:1rem 0 1.5rem;color:var(--m);font-size:.82rem}
    @media (max-width:920px){.hero,.grid3,.admin,.imgs{grid-template-columns:1fr}.top .wrap{flex-direction:column;align-items:start}}
    @media print{body *{visibility:hidden} #printArea,#printArea *{visibility:visible} #printArea{position:absolute;inset:0;background:#fff;color:#000;padding:16px}}
  </style>
</head>
<body>
  <header class="top">
    <div class="wrap">
      <div class="logo"><div class="mark">N</div><div><strong>Iqlim o'zgarishi bo'yicha Milliy markaz</strong><small>National Center for Climate Change</small></div></div>
      <nav>
        <a href="#markaz">Markaz</a><a href="#qaror">Qarorlar</a><a href="#news">Yangiliklar</a><a href="#admin">Admin</a><a href="#src">Manbalar</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <article class="card">
        <span class="pill">Internet manbalari bilan to'ldirildi</span>
        <h1>Iqlim va atmosfera bo'yicha yangilangan portal</h1>
        <p id="desc" class="muted" style="margin-top:.6rem">Markaz bo'yicha ma'lumotlar, oxirgi qarorlar, va Farrux Sattarov haqidagi yangiliklar jamlandi.</p>
        <div id="dataStatus" class="status warn">Ma'lumotlar yuklanmoqda...</div>
      </article>
      <aside class="card">
        <h3 style="font-size:1rem;margin-bottom:.55rem">Asosiy ko'rsatkichlar</h3>
        <div class="meta">
          <div><strong>Oxirgi update</strong><span id="updated">-</span></div>
          <div><strong>Qarorlar</strong><span id="dcount">-</span></div>
          <div><strong>Yangiliklar</strong><span id="ncount">-</span></div>
          <div><strong>Admin login</strong><span><code>uzncc</code></span></div>
        </div>
      </aside>
    </section>

    <section id="markaz" class="card">
      <div class="head"><div><h2>Milliy markaz haqida</h2><p id="org" class="muted"></p></div></div>
      <div id="highlights" class="grid3"></div>
    </section>

    <section id="qaror" class="card">
      <div class="head"><div><h2>So'nggi iqlim va atmosfera qarorlari</h2><p class="muted">Aniq sanalar bo'yicha tartiblangan.</p></div></div>
      <div id="decisions" class="timeline"></div>
    </section>

    <section id="news" class="card">
      <div class="head">
        <div><h2>Yangiliklar (Farrux Sattarov misoli bilan)</h2><p class="muted">Qidiruv va teg filter qo'shildi.</p></div>
        <div class="tools">
          <input id="q" type="search" placeholder="Qidiruv...">
          <select id="tag"><option value="all">Barcha teglar</option><option value="kadr">Kadr</option><option value="institut">Institut</option><option value="atmosfera">Atmosfera</option><option value="reyting">Reyting</option></select>
        </div>
      </div>
      <div id="newsList" class="timeline"></div>
    </section>

    <section id="admin" class="card">
      <div class="head"><div><h2>Administrator nashr markazi</h2><p class="muted">Word + rasm yuklash, nashr qilish va chop etish (faqat admin).</p></div></div>
      <div class="admin">
        <div id="gate" class="item">
          <h3 style="font-size:1rem;margin-bottom:.55rem">Admin kirishi</h3>
          <form id="loginForm">
            <div class="field"><label for="u">Login</label><input id="u" required autocomplete="username"></div>
            <div class="field"><label for="p">Parol</label><input id="p" type="password" required autocomplete="current-password"></div>
            <button class="pri" type="submit">Kirish</button>
          </form>
          <p class="muted" style="margin-top:.5rem">Login: <code>uzncc</code>, Parol: <code>bunyodkor7a</code></p>
          <div id="msg" class="status warn">Admin holati yopiq.</div>
        </div>
        <div id="panel" class="item hidden">
          <h3 style="font-size:1rem;margin-bottom:.55rem">Word hujjatdan nashr</h3>
          <form id="docForm">
            <div class="field"><label for="title">Sarlavha</label><input id="title" required></div>
            <div class="field"><label for="doc">Word (.docx) yoki txt (.txt)</label><input id="doc" type="file" accept=".docx,.txt,.doc"></div>
            <div class="field"><label for="imgs">Rasmlar</label><input id="imgs" type="file" accept="image/*" multiple></div>
            <div class="field"><label for="note">Qo'shimcha izoh</label><textarea id="note"></textarea></div>
            <div class="tools">
              <button id="previewBtn" type="button">Preview</button>
              <button class="pri" type="submit">Nashrni saqlash</button>
              <button id="logout" type="button">Chiqish</button>
            </div>
          </form>
          <p class="muted" style="margin-top:.45rem">.doc format brauzerda to'g'ridan o'qilmaydi, .docx tavsiya etiladi.</p>
        </div>
      </div>
      <div class="item" style="margin-top:.6rem">
        <h3 style="font-size:1rem;margin-bottom:.45rem">Nashr preview</h3>
        <div id="preview" class="muted">Preview hali tayyorlanmagan.</div>
      </div>
    </section>

    <section class="card">
      <div class="head"><div><h2>Administrator nashrlari</h2><p class="muted">Saqlash joyi localStorage. Chop etish faqat admin holatida chiqadi.</p></div></div>
      <div id="pubs" class="pubs"></div>
    </section>

    <section id="src" class="card">
      <div class="head"><div><h2>Ishlatilgan manbalar</h2><p class="muted">Saytdagi faktlar quyidagi havolalardan olindi.</p></div></div>
      <ul id="sources" class="src"></ul>
    </section>
  </main>

  <div id="printArea" class="hidden"></div>
  <footer><div class="wrap">Xavfsizlik eslatmasi: bu statik demo. Real loyiha uchun admin autentifikatsiyasi server tomonda bo'lishi shart.</div></footer>

  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script>
    const D={lastUpdated:"2026-02-12",center:{description:"assets/data/site-content.json yuklanadi.",parentOrg:"",highlights:[]},decisions:[],news:[],sources:[]};
    const USER="uzncc",PASS="bunyodkor7a",SK="nccc_admin_session_v1",PK="nccc_admin_publications_v1";
    let data=D,admin=localStorage.getItem(SK)==="1";
    const $=(i)=>document.getElementById(i),E={status:$("dataStatus"),updated:$("updated"),dcount:$("dcount"),ncount:$("ncount"),desc:$("desc"),org:$("org"),high:$("highlights"),dec:$("decisions"),q:$("q"),tag:$("tag"),news:$("newsList"),src:$("sources"),gate:$("gate"),panel:$("panel"),msg:$("msg"),login:$("loginForm"),logout:$("logout"),docForm:$("docForm"),title:$("title"),doc:$("doc"),imgs:$("imgs"),note:$("note"),previewBtn:$("previewBtn"),preview:$("preview"),pubs:$("pubs"),print:$("printArea")};
    document.addEventListener("DOMContentLoaded",init);
    async function init(){await load();renderTop();renderNews();renderSources();bind();adminState();renderPubs()}
    async function load(){
      try{
        const r=await fetch("assets/data/site-content.json",{cache:"no-store"}); if(!r.ok) throw new Error("HTTP "+r.status);
        data=await r.json(); E.status.textContent="assets/data/site-content.json yuklandi."; E.status.className="status ok";
      }catch(e){data=D; E.status.textContent="JSON yuklanmadi, fallback ishlatilmoqda: "+e.message; E.status.className="status warn";}
    }
    function renderTop(){
      E.updated.textContent=f(data.lastUpdated); E.dcount.textContent=String((data.decisions||[]).length); E.ncount.textContent=String((data.news||[]).length);
      E.desc.textContent=data.center.description||""; E.org.textContent=data.center.parentOrg||"";
      E.high.innerHTML=(data.center.highlights||[]).map(x=>`<article class="tile"><h3>${h(x.title)}</h3><p>${h(x.detail)}</p><a target="_blank" rel="noopener noreferrer" href="${a(x.source)}">Manba</a></article>`).join("")||"<p class='muted'>Highlight topilmadi.</p>";
      E.dec.innerHTML=[...(data.decisions||[])].sort((x,y)=>y.date.localeCompare(x.date)).map(x=>`<article class="item"><div class="item-top"><span class="badge">${h(x.category||"Qaror")}</span><time>${f(x.date)}</time></div><h3 style="font-size:1rem">${h(x.title)}</h3><p>${h(x.summary)}</p><a target="_blank" rel="noopener noreferrer" href="${a(x.source)}">Manba</a></article>`).join("")||"<p class='muted'>Qarorlar topilmadi.</p>";
    }
    function renderNews(){
      const q=(E.q.value||"").trim().toLowerCase(),t=E.tag.value||"all";
      const list=[...(data.news||[])].sort((x,y)=>y.date.localeCompare(x.date)).filter(x=>t==="all"?1:x.tag===t).filter(x=>q?(x.title+" "+x.summary+" "+x.tag).toLowerCase().includes(q):1);
      E.news.innerHTML=list.map(x=>`<article class="item"><div class="item-top"><time>${f(x.date)}</time><span class="badge">${h(x.tag)}</span></div><h3 style="font-size:1rem">${h(x.title)}</h3><p>${h(x.summary)}</p><a target="_blank" rel="noopener noreferrer" href="${a(x.source)}">Manba</a></article>`).join("")||"<div class='muted'>Natija topilmadi.</div>";
    }
    function renderSources(){E.src.innerHTML=(data.sources||[]).map(s=>`<li><strong>${h(s.title)}</strong><br><a target="_blank" rel="noopener noreferrer" href="${a(s.url)}">${h(s.url)}</a></li>`).join("")||"<li>Manbalar bo'sh.</li>"}
    function bind(){
      E.q.addEventListener("input",renderNews); E.tag.addEventListener("change",renderNews);
      E.login.addEventListener("submit",(e)=>{e.preventDefault(); const u=$("u").value.trim(),p=$("p").value; if(u===USER&&p===PASS){admin=true;localStorage.setItem(SK,"1");setMsg("Admin kirishi muvaffaqiyatli.","ok")}else{admin=false;localStorage.removeItem(SK);setMsg("Login yoki parol xato.","err")} adminState()});
      E.logout.addEventListener("click",()=>{admin=false;localStorage.removeItem(SK);setMsg("Admin sessiyasi yopildi.","warn");adminState()});
      E.previewBtn.addEventListener("click",async()=>{try{const d=await buildDraft();E.preview.innerHTML=pubHtml(d,false);setMsg("Preview tayyorlandi.","ok")}catch(e){setMsg(e.message,"err")}});
      E.docForm.addEventListener("submit",async(e)=>{e.preventDefault(); if(!admin){setMsg("Nashr saqlash faqat admin uchun.","err");return;} try{const p=await buildDraft(); if(!p.bodyHtml.trim()) throw new Error("Nashr matni bo'sh."); const list=pubs(); list.unshift(p); localStorage.setItem(PK,JSON.stringify(list)); E.docForm.reset(); E.preview.innerHTML="<div class='muted'>Preview hali tayyorlanmagan.</div>"; setMsg("Nashr saqlandi.","ok"); renderPubs();}catch(err){setMsg(err.message,"err")}});
      E.pubs.addEventListener("click",(e)=>{const t=e.target; if(!(t instanceof HTMLElement))return; const id=t.getAttribute("data-print"); if(id) printPub(id);});
    }
    function adminState(){admin?(E.gate.classList.add("hidden"),E.panel.classList.remove("hidden")):(E.gate.classList.remove("hidden"),E.panel.classList.add("hidden")); renderPubs()}
    function setMsg(m,c){E.msg.textContent=m; E.msg.className="status "+c}
    async function buildDraft(){
      const title=(E.title.value||"").trim(); if(!title) throw new Error("Sarlavha majburiy.");
      let body=""; const file=E.doc.files[0];
      if(file){const n=file.name.toLowerCase();
        if(n.endsWith(".docx")){if(!window.mammoth) throw new Error("DOCX parser yuklanmadi."); const r=await window.mammoth.convertToHtml({arrayBuffer:await file.arrayBuffer()}); body=safe(r.value||"");}
        else if(n.endsWith(".txt")) body=toP(await file.text());
        else if(n.endsWith(".doc")) throw new Error(".doc ni .docx ga aylantiring.");
        else throw new Error("Faqat .docx yoki .txt.");
      }
      const note=(E.note.value||"").trim(); if(note) body+=toP(note); const imgs=await readImgs(E.imgs.files);
      return{id:id(),title,createdAt:new Date().toISOString(),bodyHtml:safe(body),images:imgs};
    }
    function renderPubs(){const list=pubs(); E.pubs.innerHTML=list.length?list.map(p=>pubHtml(p,admin)).join(""):"<div class='muted'>Hozircha nashr yo'q.</div>"}
    function pubHtml(p,canPrint){const im=(p.images||[]).map(i=>`<img src="${a(i.url)}" alt="${a(i.name||"rasm")}">`).join(""); return `<article class="item"><div class="item-top"><div><h3 style="font-size:1rem">${h(p.title)}</h3><time>${f((p.createdAt||"").slice(0,10))}</time></div>${canPrint?`<button data-print="${a(p.id)}">Chop etish</button>`:""}</div><div class="preview">${p.bodyHtml||"<p>Matn yo'q.</p>"}</div>${im?`<div class="imgs">${im}</div>`:""}</article>`}
    function printPub(idv){if(!admin){alert("Chop etish faqat admin uchun.");return;} const p=pubs().find(x=>x.id===idv); if(!p){alert("Nashr topilmadi.");return;} E.print.innerHTML=pubHtml(p,false); E.print.classList.remove("hidden"); window.print(); E.print.classList.add("hidden"); E.print.innerHTML=""}
    function pubs(){try{const x=JSON.parse(localStorage.getItem(PK)||"[]"); return Array.isArray(x)?x:[]}catch{return[]}}
    function readImgs(fs){return Promise.all(Array.from(fs||[]).map(fm=>new Promise((ok,bad)=>{const r=new FileReader(); r.onload=()=>ok({name:fm.name,url:String(r.result||"")}); r.onerror=()=>bad(new Error("Rasm o'qilmadi: "+fm.name)); r.readAsDataURL(fm)})))}
    function toP(t){const n=String(t||"").replace(/\r\n/g,"\n").trim(); return n?"<p>"+h(n).split(/\n{2,}/).map(s=>s.replace(/\n/g,"<br>")).join("</p><p>")+"</p>":""}
    function safe(x){return String(x||"").replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,"").replace(/\son\w+="[^"]*"/gi,"")}
    function f(d){if(!d)return"-"; const x=new Date(d+"T00:00:00"); return Number.isNaN(x.getTime())?d:x.toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"2-digit"})}
    function id(){return"pub_"+Date.now()+"_"+Math.random().toString(16).slice(2,8)}
    function h(v){return String(v||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
    function a(v){return h(v).replace(/`/g,"")}
  </script>
</body>
</html>
